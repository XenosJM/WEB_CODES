<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HW4</title>
<script src="https://code.jquery.com/jquery-3.7.1.slim.js">
	
</script>
<style>
.contentOff {
	display: none;
}

.contentOn {
	display: block;
}
</style>
</head>
<body>
	<!-- 
상품목록 선택 박스를 누르면 상품이름과, 상품가격이 3개 뜬다.
선택박스를 안만들고 div를 빼서 목록으로 먼저 만들어보기.
이렇게 목록에 나타난 상품을 클릭하면 다른 div창(이하 장바구니)에 추가된다.
같은 상품을 한번더 클릭하면 이미 존재하는 상품입니다라는 alert가 뜬다.
장바구니에 추가된 상품은 상품정보, 가격과 함께 추가 구매를 할수있는 버튼 + - 버튼 두개와 장바구니에서 뺄수있는 x버튼,
구매수량을 직접 적어 넣을수있는 input창이 장바구니에 추가된다.
이렇게 추가된 상품이 존재할경우 다른 div창에 상품의 총 가격과 수량이 보이는데 이 창은 + - 버튼이 눌릴 때, 
input창에 숫자를 입력후 엔터를 누를 때, 상품이 장바구니에서 빠져나갈 때 마다 값의 합이 변한다.
상품 셀렉트 창 ->  고른 품목에 해당하는 상품 목록 -> 목록중에서 클릭한 상품을 장바구니로 -> 장바구니에서 추가 행동.

 -->
	<h1>정민이네 만물상</h1>
	<select>
		<option value="nuts_list">견과류</option>
		<option value="fruit_list">과일</option>
		<option value="snack_list">과자</option>
	</select>
	<div>
		<ul class="item_list">
			<li>
				<div class="info">
					<strong>호두</strong>
					<div class="price">
						<span class="val">1000</span>
					</div>
				</div>
			</li>
			<li>
				<div class="info">
					<strong>잣</strong>
					<div class="price">
						<span class="val">1200</span>
					</div>
				</div>
			</li>
			<li>
				<div class="info">
					<strong>피스타치오</strong>
					<div class="price">
						<span class="val">1500</span>
					</div>
				</div>
			</li>
		</ul>
	</div>
	<hr>
	<div>
		장바구니
		<ul class="selected_list">

		</ul>
		<button class="prod_selAll" id="btnSelectAll">전체선택</button>
		<br>
		<button class="prod_selDel" id="btnSelectCancel">선택상품 제거</button>
		<br>
	</div>
	<hr>
	장바구니 총합
	<div class="list_all"></div>
	<script type="text/javascript">
		$(document).ready(function() {
			$('ul').on('click', 'li .info', function() {
				
				let optionName = $(this).find('strong').text();
				let optionPrice = $(this).find('.price .val').text();
				// console.log('optionName : ' + optionName);
				// console.log('optionPrice : ' + optionPrice);
				
				let optionItem = $('<li class="option_item"></li>');
				let selectOptionName = $('<div class="option_name"></div>');
				let inputQty = $('<input class="num" type="number"><br>');
				inputQty.val(1);
				let btnPlus = $('<button class="qty_plus">상품 추가</button>');
				let btnMinus = $('<button class="qty_minus">상품 감소</button><br>');
				let prodSumOutput = $('<div class="option_price"></div>');
				let btnCancel = $('<button class="prod_del">상품 제거</button><br>');
				let checkBox = $('<input class="check" type="checkbox">선택<br>');
				// console.log(selectOptionName.text());
				// console.log($('.selected_list').find('.option_item .option_name').text());
				
				// console.log($('.selected_list').find('.option_name').text());
				if($('.selected_list').find('.option_name').text().match(optionName)){
					alert('이미 존재하는 상품입니다.');
				}else{
				optionItem.append(checkBox);
				selectOptionName.text(optionName);
				prodSumOutput.text(optionPrice);
				optionItem.append(inputQty);
				optionItem.append(selectOptionName);
				optionItem.append(btnPlus);
				optionItem.append(btnMinus);
				optionItem.append(prodSumOutput);
				optionItem.append(btnCancel);
				$('.selected_list').append(optionItem); //  요소 추가
				};
					
				totalSum();
				btnPlus.click(function(){
					inputQty.val(parseInt(inputQty.val())+1);
					prodSumOutput.text(parseInt(inputQty.val()) * parseInt(optionPrice));
					// console.log($('.selected_list').find('.option_price').text());
					totalSum();
				});
				inputQty.change(function(){
					prodSumOutput.text(parseInt(inputQty.val()) * parseInt(optionPrice));
					totalSum();
				});
				btnMinus.click(function(){
					inputQty.val(parseInt(inputQty.val())-1);
					if(inputQty.val() < 0){
						alert('구매수량은 0보다 낮아질수 없습니다.');
						inputQty.val(0);
					} else {
					prodSumOutput.text(parseInt(inputQty.val()) * parseInt(optionPrice));
					totalSum();
					}
				});
				btnCancel.click(function(){ // 부모요소 삭제
				// console.log($('.prod_del').parent().prop('tagName'));
					$(this).parent().remove();
					totalSum();
				});
				checkBox.click(function(){
					//console.log(checkBox.is(':checked'));
				});
				$('#btnSelectAll').click(function(){
					// 멍청하게도 위에 체크박스가 클릭될때마다 체크여부를확인하는 코드를 짜놓고도
					// 어렵게 생각해서 빙빙 돌아가면서 짠 코드
					/* if($('.selected_list').find('.option_item .check'==true)) { // 체크박스가 체크되어있다면.
						// 셀렉티드 리스트의 프로퍼티중 체크가 false면 값을 true로 변경하는게 내 의도
						$('.option_item .check').prop('checked', false);
					console.log('.check');
					} else if($('.selected_list').find('.option_item .check'==true)) {
						$('.option_item .check').prop('checked', true);
					}; */
					// 결국 input태그의 클래스가 check인 체크박스의 값의 여부만 알면되기때문에
					// 체크가 되어있는지만 확인하면 되는걸 깨닫고 변경한 코드
					if($('.option_item .check').is(':checked')) {
						$('.option_item .check').prop('checked', false);
						} else { // 체크박스가 체크되어있다면.
						$('.option_item .check').prop('checked', true);
						};
				});
				$('#btnSelectCancel').click(function(){
							//console.log('부모 : ' + $('.check').parent());
					$('.selected_list').find('.option_item .check:checked').parent().remove();
							totalSum();
					});
				
				
				function totalSum(){
					let totalPrice = 0;
					$('.selected_list .option_price').each(function(index, element){
						let price = parseInt($(element).text());
						// console.log(index);
						// console.log(element);
						// console.log('price : '+ price);
						totalPrice += price;
					});
					// console.log('totalPrice : ' + totalPrice);
					$('.list_all').text(totalPrice);
				};
			}); // item_list.on();
		}); // 둥 document()
	

	</script>

</body>
</html>










